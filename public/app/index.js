!function(t){var e={};function n(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e){t.exports=preact},function(t,e){t.exports=rxjs},function(t,e){t.exports=rxjs/operators},function(t,e){t.exports=preact/hooks},function(t,e,n){"use strict";n.r(e);var o=n(1),s=n(0),r=n(3);n(2);const i=Object(s.createContext)({});class c extends s.Component{constructor(){super(...arguments),this.$=new o.Subscription,this.state={template:()=>Object(s.h)(s.Fragment,{}),context:{},declarations:{}},this.setTemplate=t=>{this.setState({template:t})}}componentDidMount(){this.state.template=this.props.template.value,this.$.add(this.props.template.subscribe(t=>this.setState({template:t}))),this.$.add(this.props.declarations.subscribe(t=>this.setState({declarations:t}))),this.$.add(this.props.context.subscribe(t=>this.setState({context:t}))),this.props.onInit.next(),this.props.onInit.complete()}componentWillUnmount(){this.$.unsubscribe(),this.props.onDestroy.next(),this.props.onDestroy.complete()}render(){return Object(s.h)(s.Fragment,{},Object(s.h)(this.state.template,{ctx:this.state.context,declarations:this.state.declarations,h:s.h,Fragment:s.Fragment}))}}class a{constructor(){this.template=new o.BehaviorSubject(()=>Object(s.h)(s.Fragment,null)),this.context=new o.BehaviorSubject({}),this.declarations=new o.BehaviorSubject({}),this.props=new o.BehaviorSubject({}),this.injectables=new o.BehaviorSubject({}),this.propEvents=new o.Subject,this.onInit=new o.Subject,this.onDestroy=new o.Subject,this.useInjectables=()=>{const t=Object(r.useContext)(i);Object(r.useEffect)(()=>this.injectables.next(t),[t])},this.usePropEvents=t=>{Object(r.useEffect)(()=>{const e=this.propEvents.subscribe(e=>t[e.key](e.value));return()=>e.unsubscribe()},[this.propEvents]),this.props.next(t)}}emitPropEvent(t,e){this.propEvents.next({key:t,value:e})}setContext(t){this.context.next(t)}setTemplate(t){this.template.next(t)}setDeclarations(t){this.declarations.next(t)}clearTemplate(){this.template.next(null)}getTemplate(){return this.template.value}getComponent(){return t=>(this.useInjectables(),this.usePropEvents(t),Object(s.h)(c,{template:this.template,context:this.context,declarations:this.declarations,onInit:this.onInit,onDestroy:this.onDestroy}))}}var u=function(t,e,n,o){return new(n||(n=Promise))(function(s,r){function i(t){try{a(o.next(t))}catch(t){r(t)}}function c(t){try{a(o.throw(t))}catch(t){r(t)}}function a(t){t.done?s(t.value):new n(function(e){e(t.value)}).then(i,c)}a((o=o.apply(t,e||[])).next())})};const p=["constructor","onInit","onDestroy","selector","render","container","type"],l=(t,e)=>{const n=Object.getOwnPropertyNames(e.prototype),o=Object.keys(t),s={};for(let e of[...n,...o])p.includes(e)||(s[e]=t[e]);return s},h=()=>()=>{};const b=()=>(1e7*Math.random()).toFixed(0).toString();let f=class{};var d;f=function(t,e,n,o){var s,r=arguments.length,i=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,o);else for(var c=t.length-1;c>=0;c--)(s=t[c])&&(i=(r<3?s(i):r>3?s(e,n,i):s(e,n))||i);return r>3&&i&&Object.defineProperty(e,n,i),i}([(d={selector:"test",template:({h:t})=>t("div",{},"Hello World")},function(t){return function(...e){const n=new a,o=new t(...e);o.type="component",o.container=n,o.selector=d.selector;const s=o.onInit||h(),r=o.afterViewInit||h(),i=o.onDestroy||h();n.onInit.subscribe(()=>u(this,void 0,void 0,function*(){yield s.apply(o);const e=l(o,t),i={};for(let t in e)i[t]=o[t],i[t].bind&&(i[t]=i[t].bind(o)),Object.defineProperty(o,t,{get:()=>i[t],set:e=>{i[t]=e,n.setContext(Object.assign({},i,{[t]:e}))}});n.setContext(i),n.setTemplate(d.template),r()})),n.onDestroy.subscribe(()=>i.apply(o));const c={};for(const t of d.declarations||[]){const e=new t;c[e.selector]=e.render()}return n.setDeclarations(c),o.render=()=>o.container.getComponent(),o}})],f),class{static useComponent(t){return this.component=t,this}static provideKeys(t){return this.state=Object.assign({},this.state,t),this}static provideInstances(t){for(const e of t)this.state[b()]=e;return this}static attachTo(t){const e=(new this.component).render();if(this.state){const n=Object(s.h)(i.Provider,{value:this.state},Object(s.h)(e,{}));Object(s.render)(n,t)}else{const n=Object(s.h)(e,{});Object(s.render)(n,t)}}}.useComponent(f).attachTo(document.body)}]);